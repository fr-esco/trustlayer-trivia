<mat-toolbar>
	<h1>Play</h1>
</mat-toolbar>

<section class="page">
	<ng-container *ngIf="questions$ | async as questions">
		<form
			[formGroup]="formGroup"
			*ngIf="formGroup"
		>
			<mat-stepper
				formArrayName="questions"
				labelPosition="bottom"
				linear
				#stepper
			>
				<mat-step
					*ngFor="let question of questions, let i = index; let first = first; let last = last;"
					[formGroupName]="i"
					[stepControl]="questionFormArray | formControlAt:i"
					#step
				>
					<small>Category: {{ question.category }} • Difficulty: {{
						question.difficulty | titlecase }}</small>
					<p [innerHTML]="question.question | safe:'html'"></p>
					<!-- TODO come si fa ??? -->
					<mat-radio-group [formControl]="questionFormArray | formControlAt:i">
						<mat-radio-button
							class="answer my-4"
							*ngFor="let answer of questions[i] | fullAnswerList"
							[value]="answer | safe:'html'"
						>
							<span [innerHTML]="answer | safe:'html'"></span>
						</mat-radio-button>
					</mat-radio-group>
					<div
						class="feedback-container my-4 p-2 border-2 border-dotted"
						[class.border-green-500]="correctFeedbackList[i]"
						[class.border-red-500]="!correctFeedbackList[i]"
						[style.visibility]="(questionFormArray | formControlAt:i).value ? 'visible' : 'hidden'"
					>
						{{ correctFeedbackList[i] ? '✔ Correct' : '❌ Wrong' }} answer.
					</div>
					<div>
						<button
							class="previous-button"
							mat-stroked-button
							matStepperPrevious
							type="button"
							*ngIf="!first"
						>Back</button>
						<button
							class="next-button"
							[disabled]="(questionFormArray | formControlAt:i).invalid"
							mat-raised-button
							matStepperNext
							color="primary"
							type="button"
						>Next</button>
					</div>
				</mat-step>
				<mat-step label="Final Score">
					<p>SCORE</p>
				</mat-step>
			</mat-stepper>
		</form>
	</ng-container>
</section>
